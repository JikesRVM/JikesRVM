<!--
Ant build file for the eclipse plug in

To display help information type:

  % ant -projecthelp

$Source$
$Revision$
$Date$
$Author$

-->
<project name="jikesrvmlaunching" basedir="." default="build">

  <property file="ant.properties"/>

  <property name="src.dir" value="src"/>
  <property name="etc.dir" value="etc"/>
  <property name="dist.dir" value="dist"/>
  <property name="build.dir" value="build"/>
  <property name="build.lib" value="${build.dir}/lib"/>
  <property name="build.src" value="${build.dir}/src"/>
  <property name="build.dist" value="${build.dir}/dist"/>
  <property name="build.classes" value="${build.dir}/classes"/>
  <property name="plugin.dir" value="${eclipse.dir}/plugins"/>
  <property name="name" value="${ant.project.name}"/>

  <property name="plugins.dir" value="${eclipse.dir}/plugins"/>
  <property name="package"     value="org.eclipse.jdt.launching.jikesrvm"/>
  <property name="install.dir" value="${plugins.dir}/${package}"/>
  <property name="build.dist.install" value="${build.dist}/${package}"/>

  <property name="build.compiler" value="jikes"/>
  <property name="build.config.debug" value="yes"/>

  <path id="project.classpath">
   <pathelement path="${build.classes}"/>
   <fileset dir="${plugin.dir}">
     <include name="**/*.jar"/>
   </fileset>
  </path>

  <target name="init">
    <tstamp>
      <format property="long.date" pattern="EEE, dd MMMMM yyyy hh:mm:ss z" locale="en"/>
    </tstamp>
  </target>

  <target name="dist" 
          depends="build.dist"
	  description="builds a distributionx">
    <mkdir dir="${dist.dir}"/>
    <tar tarfile="${dist.dir}/${name}.tar" basedir="${build.dist}"/>
    <gzip src="${dist.dir}/${name}.tar" zipfile="${dist.dir}/${name}.tar.gz"/>
    <delete file="${dist.dir}/${name}.tar"/>
  </target>

  <target name="build.dist" depends="build.jar">
    <mkdir dir="${build.dist}"/>
    <mkdir dir="${build.dist.install}"/>
    <copy todir="${build.dist.install}" overwrite="yes">
      <fileset dir="${etc.dir}">
        <include name="*.properties"/>
        <include name="*.xml"/>
      </fileset>
    </copy>
    <copy todir="${build.dist}" overwrite="yes">
      <fileset dir="${etc.dir}">
        <include name="*README*"/>
      </fileset>
    </copy>
    <copy todir="${build.dist.install}" 
          overwrite="yes" 
	  file="${build.lib}/${name}.jar"/>
  </target>

  <target name="reinstall" 
          depends="clean.all,install"
	  description="cleans an reinstalls the plugin"/>

  <target name="install" 
          depends="build.dist"
          description="installs the plug-in to ${install.dir}">
    <mkdir dir="${install.dir}"/>
    <copy todir="${install.dir}" overwrite="yes">
      <fileset dir="${build.dist.install}"/>
    </copy>
  </target>

  <target name="build.jar" depends="build">
    <mkdir dir="${build.lib}"/>
    <jar jarfile="${build.lib}/${name}.jar" basedir="${build.classes}"/>
  </target>

  <target name="build"
          depends="build.src"
          description="compiles source code">
    <mkdir dir="${build.classes}"/>
    <javac destdir="${build.classes}"
	   classpathref="project.classpath"
	   debug="${build.config.debug}">
      <src path="${src.dir}"/>
      <src path="${build.src}"/>
    </javac>
    <copy todir="${build.classes}">
      <fileset dir="${src.dir}" >
        <include name="**/*.properties"/>
      </fileset>
    </copy>
  </target>

  <target name="build.src" depends="init">
    <filter token="long.date" value="${long.date}"/>
    <copy file="${etc.dir}/BuildInfo.java"
          overwrite="yes"
          filtering="yes"
	  todir="${build.src}/org/eclipse/jdt/internal/launching/jikesrvm"/>
  </target>

  <target name="clean" description="cleans the built classes">
    <delete quiet="yes" dir="${build.dir}"/>
  </target>

  <target name="clean.install" description="cleans installation path">
    <delete quiet="yes" dir="${install.dir}"/>
  </target>

  <target name="clean.all" description="cleans everything">
    <antcall target="clean"/>
    <antcall target="clean.install"/>
    <antcall target="clean.dist"/>
  </target>

  <target name="clean.dist" description="cleans the dist path">
    <delete quiet="yes" dir="${dist.dir}"/>
  </target>

</project>
