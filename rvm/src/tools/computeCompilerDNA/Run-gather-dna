#!/bin/ksh

#
# (C) Copyright IBM Corp. 2001
#
# $Id$

# This script will run the system on the SPECjvm98 benchmarks using various 
# compilers to determine their "DNA", i.e., their compilation rate and speedup.
#
# The perl script computeDNA.pl will process the output of this script to 
# produce a summary of the results    
#
# Preconditions
#   1) You must first build the following images
#        FastAdaptiveSemispace (for compilation rates)   
#        FastBaseBaseSemispace (for speedup)
#        FastOpt0Semispace (for speedup)
#        FastOpt1Semispace (for speedup)
#        FastSemispace (for speedup)
#  
#   2) Run the script in the SPECjvm98 directory redirecting the output to a file
#
#   3) Run computeDNA.pl on this file
#
#  Michael Hind, Oct 30, 2001

# parent of build diectories is command line argument to the script
BUILDDIR=$1

# Define benchmark groups
all='_201_compress _202_jess _209_db _213_javac _222_mpegaudio _227_mtrt _228_jack'
#all='_202_jess'

jvmoptions="	-X:h=400 -X:lh=100"
jvmcompoptions="	-X:h=400 -X:lh=100 -X:measureCompilation=true"
appcompoptions="	-d3000 -g -m1 -M1 -s100"
appperfoptions="	-d3000 -g -m5 -M5 -s100"

# If you want verbose output of command executions...
set -x

PROCS="1"
OPTLEVELS="O0 O1 O2"

for benchmark in $all
do

# Compilation rates first
  export RVM_BUILD=$BUILDDIR/FastAdaptiveSemispace
  rvm $jvmcompoptions -X:processors=$PROCS -X:aos:primary_strategy=baseonly SpecApplication $appcompoptions -a $benchmark

  for optLevel in $OPTLEVELS
  do
    rvm $jvmcompoptions -X:processors=$PROCS -X:aos:primary_strategy=optonly -X:aos:irc:$optLevel SpecApplication $appcompoptions  -a $benchmark
  done

done

for benchmark in $all
do
# Performance next
   export RVM_BUILD=$BUILDDIR/FastBaseBaseSemispace
   rvm $jvmoptions -X:processors=$PROCS SpecApplication $appperfoptions  -a $benchmark

   export RVM_BUILD=$BUILDDIR/FastOpt0Semispace
   rvm $jvmoptions -X:processors=$PROCS -X:irc:O0 SpecApplication $appperfoptions  -a $benchmark

   export RVM_BUILD=$BUILDDIR/FastOpt1Semispace
   rvm $jvmoptions -X:processors=$PROCS -X:irc:O1 SpecApplication $appperfoptions  -a $benchmark

   export RVM_BUILD=$BUILDDIR/FastSemispace
   rvm $jvmoptions -X:processors=$PROCS -X:irc:O2 SpecApplication $appperfoptions  -a $benchmark

done


