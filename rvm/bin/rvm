#!/bin/ksh
#
# (C) Copyright IBM Corp. 2001
#
# $Id$
#
# Invoke Jikes RVM virtual machine that was created by "jbuild".
# See also: $RVM_ROOT/rvm/bin/jconfigure -help
#
# @author Derek Lieber
# @date 04 Feb 2000
#
# @modified Peter Sweeney
# @date 15 Jan 2001 
#    eliminate dependence on option order.
#

ME=`basename $0`

# Place where RVM bootimage, booter, and runtime support files reside.
#
if [[ $RVM_BUILD = "" ]]; then
   print "$ME: please set your RVM_BUILD environment variable (eg. $HOME/rvmBuild)"
   exit 1
fi

. $RVM_BUILD/environment

if [[ X`uname` = X"CYGWIN_NT-5.0" ]]; then
  # need to kludge path to image because we use win32 api calls to mmap it.
  # other paths can be left in "unix" form; we use cygwin api calls for them.
  ARGS="-X:i=`cygpath -p -w $RVM_BUILD/RVM.image`"
  ARGS="$ARGS -X:vmClasses=`cygpath -p -w $RVM_BUILD`"
else
  ARGS="-X:i=$RVM_BUILD/RVM.image"
  if [[ ! -e $RVM_BUILD/javamath.jar ]]; then
    ARGS="$ARGS -X:vmClasses=$RVM_BUILD/RVM.classes/jksvm.jar:$JAZZLIBJAR:$RVM_BUILD/RVM.classes/rvmrt.jar"
  else
    ARGS="$ARGS -X:vmClasses=$RVM_BUILD/RVM.classes/jksvm.jar:$JAZZLIBJAR:$RVM_BUILD/javamath.jar:$RVM_BUILD/RVM.classes/rvmrt.jar"
  fi
fi
for arg in $*; do
   if   [[ $arg = --   ]]; then
     print "$ME: the command line option \"--\" is no longer used!"
   fi
done

ARGS="$ARGS -Duser.home=$HOME -Duser.dir=`pwd` -Dos.name=`uname -s` -Dos.version=`uname -r` -Dos.arch=`uname -m`"

LOADPATH=$RVM_BUILD:$HOST_JAVA_HOME/jre/bin:$HOST_JAVA_HOME/jre/bin/classic
typeset -x LIBPATH=$LIBPATH:$LOADPATH
typeset -x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$LOADPATH
exec $RVM_BUILD/JikesRVM $ARGS "$@"

